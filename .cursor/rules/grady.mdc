---
description: when creating an app logic
alwaysApply: false
---

## Current Working Features

### âœ… Authentication & Authorization

- Complete Supabase Auth integration
- Role-based access control (RBAC)
- Secure session management
- Partner-based permissions
- Invitation system with email notifications

### âœ… Multi-Tenant Partner System

- Partner-based routing with `[env]` parameter
- Complete data isolation between partners
- Partner switcher with logos and keyboard shortcuts
- Admin-only partner creation with logo upload
- User invitation and membership management (Partner Managers only)

### âœ… Dashboard & Navigation

- Partner-specific dashboard layouts
- Sidebar navigation with partner switcher and logos
- SPA-style navigation (no full page reloads)
- Active route highlighting
- Breadcrumb navigation
- Mobile-responsive design

### âœ… Product Management

- Complete CRUD operations for products
- Product status tracking with history
- Category system with hierarchical organization
- CSV import with validation and error handling
- Bulk operations (status updates, deletion)
- Product search and filtering
- Image upload support (schema ready)
- Action buttons integrated into table toolbar

### âœ… Location Management

- Location CRUD operations
- Location-specific product tracking
- Contact information management
- Location statistics and analytics

### âœ… Member Management

- User invitation system
- Role assignment and management (Partner Managers only)
- Member activity tracking
- Partner access control
- Action buttons integrated into table toolbar

### âœ… Analytics & Reporting

- Dashboard statistics and metrics
- Product status distribution
- Revenue tracking
- Time-to-sale analytics
- Location-based reporting

### âœ… Settings & Configuration

- User profile management
- Environment settings
- Notification preferences
- Security settings

---

## Development Guidelines

### Code Style

- Follow Standard.js rules (2 spaces, no semicolons, camelCase)
- Use functional components with hooks
- Prefer server components over client components
- Use TypeScript for type safety
- Follow the established file structure

### Navigation Rules

- Use `import Link from "next/link"` for all navigation
- Use `const router = useRouter(); router.push(url)` for programmatic navigation
- All routes render inside the dashboard layout - no full refresh
- Sidebar items use Link and highlight active routes
- Environment-based routing: `/[env]/[section]`

### UI Rules

- Use shadcn/ui components only - no native HTML styling
- Import from `@/components/ui/[component]`
- Use Tailwind CSS for styling
- Follow shadcn/ui design patterns
- Ensure mobile responsiveness

### Table Component Rules

- **Action Buttons**: Place action buttons (Add Product, Invite Users, etc.) in
  the table toolbar alongside filter and view options, not as separate buttons
  near page headings
- **DataTable Props**: Use `actionButtons` prop to pass custom buttons to table
  toolbar
- **Filter Placeholders**: Use `filterPlaceholder` prop for context-appropriate
  filtering (e.g., "Filter products...", "Filter members...")
- **Mobile Layout**: Use `space-y-4` instead of
  `flex items-center justify-between` for page headers to ensure proper mobile
  stacking
- **Row Selection**: Disabled by default (`enableRowSelection: false`) - only
  enable when bulk actions are needed
- **Default Page Size**: Set to 10 rows
  (`initialState: { pagination: { pageSize: 10 } }`)
- **Pagination Display**: Show "X total row(s)" instead of selection count, hide
  "Rows per page" selector

### Data Fetching

- Use React Server Components for data fetching where possible
- Use server actions for mutations
- Implement proper error handling
- Use revalidatePath/router.refresh() after mutations
- Partner-scoped data access

### Security Rules

- All routes require authentication
- Partner-based data access control
- Role-based permissions
- Input validation with Zod schemas
- Secure API endpoints with RLS

---

## Production Setup

### 1. Environment Variables

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Email Configuration (Resend)
RESEND_API_KEY=your_resend_api_key
EMAIL_FROM_ADDRESS=noreply@your-domain.com
NEXT_PUBLIC_APP_URL=https://your-domain.com

# Optional: Debug Configuration
DEBUG_EMAILS=false
```

### 2. Database Setup

```bash
# Run all migrations in order
supabase/migrations/001_initial_schema.sql
supabase/migrations/002_create_storage_bucket.sql
supabase/migrations/003_rename_environments_to_partners.sql
supabase/migrations/004_fix_storage_policies.sql
```

### 3. Admin User Creation

```bash
node scripts/create-admin-user.js
```

### 4. Partner Creation

- Use admin dashboard to create production partners
- Invite team members with appropriate roles (Partner Managers only)
- Configure partner settings and upload logos

---

## Testing the Implementation

### Start Development Server

```bash
npm run dev
```

### Test Routes

- **Login**: http://localhost:3000/login
- **Admin Dashboard**: http://localhost:3000/admin
- **Partner Dashboard**: http://localhost:3000/[env]
- **Products**: http://localhost:3000/[env]/products
- **Locations**: http://localhost:3000/[env]/locations
- **Members**: http://localhost:3000/[env]/members
- **Analytics**: http://localhost:3000/[env]/analytics
- **Settings**: http://localhost:3000/[env]/settings

### Current Working Features

- âœ… Complete authentication system
- âœ… Multi-tenant partner management
- âœ… Product management with CSV import
- âœ… Location management
- âœ… Member management with invitations (Partner Managers only)
- âœ… Analytics and reporting
- âœ… Settings and configuration
- âœ… Mobile-responsive design
- âœ… TypeScript compilation
- âœ… All components working
- âœ… Partner logo support and display

---

## Acceptance Criteria Status

1. âœ… **Authentication**: Complete Supabase Auth integration
2. âœ… **Multi-Tenancy**: Partner-based data isolation
3. âœ… **Navigation**: All navigation uses Next.js routing
4. âœ… **UI Components**: Every component uses shadcn/ui
5. âœ… **RLS**: Row-level security implemented
6. âœ… **Product Management**: Complete CRUD with status tracking
7. âœ… **CSV Import**: Bulk import with validation
8. âœ… **Member Management**: Invitation system with roles (Partner Managers
   only)
9. âœ… **Analytics**: Dashboard statistics and reporting
10. âœ… **Security**: Comprehensive security measures

---

## File Updates Made

### Recently Completed

- âœ… Removed all demo content and functionality
- âœ… Updated all database functions for production use
- âœ… Implemented complete authentication system
- âœ… Added partner-based access control with logo support
- âœ… Updated all components for real data
- âœ… Implemented invitation system (Partner Managers only)
- âœ… Added email functionality
- âœ… Updated documentation for production
- âœ… Integrated action buttons into table toolbars
- âœ… Improved mobile responsiveness and table display
- âœ… Added partner logo support in sidebar and switcher

### Current Working Files

- All TypeScript files compile without errors
- All components render correctly
- Navigation works as expected
- Database operations work with real data
- Email system functional
- Security measures implemented

---

**Status**: ðŸŸ¢ **PRODUCTION READY**

The application is now production-ready with complete multi-tenant
functionality, proper authentication, and comprehensive security measures. All
demo content has been removed and the system works exclusively with real
partners and user data.

pages, implement server actions, and apply RLS. Include a README.md with setup
and migration steps.
